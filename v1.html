<head>
<script>

  var clientId = '775021312886-0dlsrrgg2mfchib14oicf2lt8ujd11t8.apps.googleusercontent.com';
  var developerKey = 'AIzaSyBTEWsJ4aXdoOzB4ey81eX9-ja7HejL4Qc';
  var accessToken;
  function onApiLoad() {
    gapi.load('auth', authenticateWithGoogle);
    gapi.load('picker');
  }
  function authenticateWithGoogle() {
    window.gapi.auth.authorize({
      'client_id': clientId,
      'scope': ['https://www.googleapis.com/auth/drive']
    }, handleAuthentication);
  }
  function handleAuthentication(result) {
    if(result && !result.error) {
      accessToken = result.access_token;
      setupPicker();
    }
  }
  function setupPicker() {
    var picker = new google.picker.PickerBuilder()
      .setOAuthToken(accessToken)
      .setDeveloperKey(developerKey)
      //.addView(new google.picker.DocsUploadView())
      .addView(new google.picker.DocsView())
      .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
      .setCallback(pickerCallback)
      .build();
    picker.setVisible(true);
  }

  function pickerCallback(data) {
    if (data.action == google.picker.Action.PICKED) {  // not CANCELED
       use_id(data.docs[0].id);
    }
  }

 /////////////////////////////////////////////////////

      var basic_key = 'AIzaSyA0wNVsiRhTqykHWvrkhjvwQ5FjIb7IlnQ'
      function appendResults(text) {
        var results = document.getElementById('results');
        results.appendChild(document.createElement('P'));
        results.appendChild(document.createTextNode(text));
      }

      function use_id(id) {
        alert('use_id'+id);
        alert(gapi.auth.getToken().access_token);
        console.log("ACCESSTOKEN");
        console.log(gapi.auth.getToken().access_token);
        console.log('====');
        var request = gapi.client.drive.files.get(
          {'id': id}
        )
        console.log('request made')
        request.execute(function(response) {
          alert ('resp'+response);
        });
      }

      function makeRequest() {
        //alert ('aT:'+accessToken); //racy
        gapi.auth.setToken(accessToken);
        var request = gapi.client.urlshortener.url.get({
          'shortUrl': 'http://goo.gl/fbsS'
        });
        request.execute(function(response) {
          appendResults(response.longUrl);
        });
      }

      function load() {
        gapi.client.setApiKey(basic_key);
        gapi.client.load('drive', 'v1'); // racy
        gapi.client.load('urlshortener', 'v1', makeRequest);
      }
    </script>

<script src="https://apis.google.com/js/client.js?onload=load"></script>
<script language='javascript' src='https://apis.google.com/js/api.js?onload=onApiLoad'></script>

</head>
<body>
  <div id="results"></div>
</body>
