<html>
  <head>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js"></script> 
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.21.5/js/jquery.tablesorter.min.js"></script> 
    <script src="//scraperwiki.com/js/scraperwiki.js"></script>

  </head>
  <body>

<table id="myTable" class="tablesorter"> 
<thead> 
<tr> 
    <th>Last Name</th> 
    <th>First Name</th> 
    <th>Email</th> 
    <th>Due</th> 
    <th>Web Site</th> 
</tr> 
</thead> 
<tbody> 
<tr> 
    <td>Smith</td> 
    <td>John</td> 
    <td>jsmith@gmail.com</td> 
    <td>$50.00</td> 
    <td>http://www.jsmith.com</td> 
</tr> 
</tbody> 
</table> 

    <script>
      function foobartable(data) {
          has_header = 0
          text = ''
          data.forEach(function(row) {
              // make header
              if (has_header == 0) {
                  text = text + '<thead><tr>'
                  Object.keys(row).forEach(function(key) {
                       text=text+'<th>'+key+'</th>'
                  })
                  text = text + '</tr></thead><tbody>'
                  has_header = 1
              }
                  
              // output row
              text=text+'<tr>';
              Object.keys(row).forEach(function(key) {
                  text=text+'<td>'+row[key]+'</td>'
              })
              text=text+'</tr>';
          })
          text = text + "</tbody>";
          return text
      }

      //$(function() {
      //    $( "#tabs" ).tabs();
      //});
      scraperwiki.sql('select round(sum(hours),2) as hrs, job, max(date) as last_date from nice group by job order by last_date desc', 
          function(data, textStatus, jqXHR){$('#myTable').html(foobartable(data)); $('#myTable').tablesorter()},
          function(jqXHR, textStatus, errorThrown){console.log('foo')}
      );
      
    </script>

  </body>
</html>
